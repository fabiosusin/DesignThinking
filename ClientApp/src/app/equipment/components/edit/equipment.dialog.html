<app-loading *ngIf="isLoading"></app-loading>
<ng-container *ngIf="form" [formGroup]="form">
  <div class="dialog-container">
    <div mat-dialog-content class="dialog-content grid-2-cl">
      <mat-form-field class="default-form-field" appearance="fill">
        <mat-label>Código</mat-label>
        <input matInput formControlName="code" required>
        <mat-error *ngIf="!form?.get('code')?.valid">Informe o Código</mat-error>
      </mat-form-field>
      <mat-form-field class="default-form-field" appearance="fill">
        <mat-label>Nome</mat-label>
        <input matInput formControlName="name" required>
        <mat-error *ngIf="!form?.get('name')?.valid">Informe o Nome</mat-error>
      </mat-form-field>
    </div>
    <div class="default-bg-textarea flex-between">
      <mat-form-field class="default-form-field default-textarea flex-start" appearance="fill">
        <mat-label>Observações</mat-label>
        <textarea matInput formControlName="note" cdkTextareaAutosize #autosize="cdkTextareaAutosize"
          cdkAutosizeMinRows="1" cdkAutosizeMaxRows="5"></textarea>
      </mat-form-field>
      <mat-form-field class="default-form-field default-textarea flex-start" appearance="fill">
        <mat-label>Avarias</mat-label>
        <textarea matInput formControlName="damageNote" cdkTextareaAutosize #autosize="cdkTextareaAutosize"
          cdkAutosizeMinRows="1" cdkAutosizeMaxRows="5"></textarea>
      </mat-form-field>
    </div>
    <div class="bg-images" *ngIf="data.images?.length">
      <div class="title title-border flex-start">
        <h1>Imagens</h1>
      </div>
      <div class="images grid-4-cl">
        <div class="image flex-center" *ngFor="let item of data.images; let i = index">
          <img [src]="item.imageUrl" />
          <a class="remove-btn flex-center" (click)="data.images?.splice(i, 1)">
            <i class="fas fa-times"></i>
          </a>
        </div>
      </div>
    </div>
    <div class="bg-images">
      <div class="title flex-start" [ngClass]="{'title-border': data.imagesBase64?.length}">
        <h1 *ngIf="data.imagesBase64?.length">Novas Imagens</h1>
        <button class="add-new-btn flex-around">
          <i class="fas fa-paperclip"></i>
          <span>Anexar Imagem</span>
          <input #fileUpload type="file" accept="image/png, image/gif, image/jpeg" class="inputFile"
            (change)="attachFile($event)" />
        </button>
      </div>
      <div class="images grid-4-cl">
        <div class="image flex-center" *ngFor="let item of data.imagesBase64; let i = index">
          <img [src]="item" />
          <a class="remove-btn flex-center" (click)="data.imagesBase64?.splice(i, 1)">
            <i class="fas fa-times"></i>
          </a>
        </div>
      </div>
    </div>
    <div class="history" *ngIf="history?.length">
      <cdk-accordion class="accordion">
        <cdk-accordion-item #accordionItem="cdkAccordionItem" class="accordion-item" role="button" tabindex="0"
          [attr.id]="'accordion-header-0'" [attr.aria-expanded]="accordionItem.expanded"
          [attr.aria-controls]="'accordion-body-0'">
          <div class="accordion-item-header" (click)="accordionItem.toggle()">
            <div class="header-filters flex-center">
              <i class="fas fa-history"></i>
              <h1>Histórico de Empréstimos</h1>
            </div>
            <span class="accordion-item-description">
              <i *ngIf="!accordionItem.expanded" class="fas fa-plus"></i>
              <i *ngIf="accordionItem.expanded" class="fas fa-minus"></i>
            </span>
          </div>
          <div class="accordion-item-body" role="region" [style.display]="accordionItem.expanded ? '' : 'none'"
            [attr.id]="'accordion-body-0'" [attr.aria-labelledby]="'accordion-header-0'">
            <div class="table grid-3-cl">
              <span class="title">Data de Devolução</span>
              <span class="title right">Avaria</span>
              <ng-container *ngFor="let item of history">
                <span>{{item.devolutionDate | brazilFullDate }}</span>
                <span class="right">{{item.damageNote }}</span>
                <hr>
              </ng-container>
            </div>
          </div>
        </cdk-accordion-item>
      </cdk-accordion>
    </div>
    <div mat-dialog-actions class="bg-buttons flex-end" *ngIf="data">
      <button class="close-button" mat-button (click)="closeDialog()">Sair</button>
      <button class="save-button" mat-button cdkFocusInitial (click)="onSubmit(form.value)">Salvar</button>
    </div>
  </div>
</ng-container>
